<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="me.edzh.sngrenthouse.backend.dao.HouseMapper">
    <select id="housesWithFilter" resultType="House">
        SELECT id,url,name,address,lat,lon,price from houses
        <if test="filter != null">
            where
            1=1
            <if test="filter.minPrice != null">
                and (price &gt; #{filter.minPrice} or price = 1000000)
            </if>
            <if test="filter.maxPrice != null">
                and (price &lt; #{filter.maxPrice} or price = 1000000)
            </if>
            <if test="filter.points != null">
                and
                <foreach collection="filter.points" separator=" or " open="(" close=")" item="point">
                    round(6378.138*2*asin(sqrt(pow(sin( (lat*pi()/180-#{point[1]}*pi()/180)/2),2)+cos(lat*pi()/180)*cos(#{point[1]}*pi()/180)* pow(sin( (lon*pi()/180-#{point[0]}*pi()/180)/2),2)))*1000) &lt; #{filter.distanceRange}
                </foreach>

            </if>
        </if>

    </select>
    <!--<select id="getWorkerByCityId" resultMap="workerMap">-->
        <!--select code,`name`,`level`,photo,user_id,phone,company,id_code,`type` from worker_info where city_id = #{cityId};-->
    <!--</select>-->

</mapper>